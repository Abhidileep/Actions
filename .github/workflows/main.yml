name: Automate Route 53 Update

on:
  workflow_dispatch:
    inputs:
      domain_name:
        description: 'Domain Name'
        required: true
      server_ip:
        description: 'Server IP'
        required: true

env:
  AWS_ROUTE53_RR_NAME: kamali.kubeace.com
  AWS_ROUTE53_RR_TYPE: A
  AWS_ROUTE53_RR_TTL: 300
  AWS_ROUTE53_RR_VALUE: 15.191.112.197

jobs:
  update-route53:
    runs-on: ubuntu-latest

    steps:
      - name: Set up AWS CLI
        uses: aws-actions/configure-aws-credentials@v1
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: ap-south-1  

      - name: Update Route 53 Records
        run: |
          aws route53 change-resource-record-sets \
            --hosted-zone-id your-hosted-zone-id \
            --change-batch "{
              \"Comment\": \"Automated update\",
              \"Changes\": [
                {
                  \"Action\": \"UPSERT\",
                  \"ResourceRecordSet\": {
                    \"Name\": \"${{ env.AWS_ROUTE53_RR_NAME }}\",
                    \"Type\": \"${{ env.AWS_ROUTE53_RR_TYPE }}\",
                    \"TTL\": ${{ env.AWS_ROUTE53_RR_TTL }},
                    \"ResourceRecords\": [
                      {
                        \"Value\": \"${{ env.AWS_ROUTE53_RR_VALUE }}\"
                      }
                    ]
                  }
                }
              ]
            }"
